kpi1_lyon <- data_lyon %>%
group_by(flag, etiquette_dpe) %>% #Je group by flag car c'est le logement et la classe DPE qui m'intéressent pour ce KPI
summarise(conso_moyenne = mean(cout_total_5_usages, na.rm = TRUE))
data_lyon <- read.csv2(url_lyon, header = TRUE)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv2(url_lyon, header = TRUE)
data_lyon$cout_total_5_usages
data_lyon$flagg
data_lyon$flagg
data_lyon$flag
unique(data_lyon$flag)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv2(url_lyon, header = TRUE)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, cout_total_5_usages) %>%
distinct()
library(dplyr)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv2(url_lyon, header = TRUE)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, cout_total_5_usages) %>%
distinct()
summarise()
summarise(data_lyon)
summarise(data_lyon$cout_total_5_usages)
summarise(data_lyon$type_energie_n1)
summarise(data_lyon)
mean(data_lyon$cout_total_5_usages)
data_lyon$cout_total_5_usages
mean(2,3,4)
mean(2,3,4,5)
mean(3,3)
mean(data_lyon$cout_total_5_usages)
mean(data_lyon$cout_total_5_usages, na.rm=TRUE)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, mean(data_lyon$cout_total_5_usages, na.rm=TRUE)) %>%
distinct()
library(dplyr)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv2(url_lyon, header = TRUE)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, mean(data_lyon$cout_total_5_usages, na.rm=TRUE)) %>%
distinct()
library(dplyr)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv(url_lyon,sep = ";",dec="," header = TRUE)
library(dplyr)
url_lyon <- "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
data_lyon <- read.csv(url_lyon,sep = ";",dec=",", header = TRUE)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, mean(data_lyon$cout_total_5_usages, na.rm=TRUE)) %>%
distinct()
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, cout_total_5_usages) %>%
distinct()
as.factor(data_lyon$flag)
data_lyon$flag = as.factor(data_lyon$flag)
data_lyon %>%
filter(etiquette_dpe == "A") %>%
select(flag, cout_total_5_usages) %>%
distinct()
---
title: "Version 2 : Étude DPE et consommations électriques (Appartements Lyon vs Lille)"
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(scales)
# Import des données
url_lyon = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
url_lille = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_59.csv"
data_lyon = read.csv2(url_lyon, header = TRUE)
data_lille = read.csv2(url_lille, header = TRUE)
# Combinaison
data_combined <- rbind(
data_lyon,
data_lille
) %>%
# (Le filter(type_batiment) est retiré, comme vous l'avez indiqué)
# On crée les métriques et on nettoie les facteurs
mutate(
# 1. Créer la variable "Ville" propre à partir du code BAN
Ville = case_when(
code_departement_ban == 69 ~ "Lyon",
code_departement_ban == 59 ~ "Lille"
),
# 2. Créer les métriques au m²
conso_m2_total = cout_total_5_usages / surface_habitable_logement,
conso_m2_chauffage = cout_chauffage / surface_habitable_logement
) %>%
# 3. Assurer l'ordre des facteurs pour les graphiques
# (On le fait séparément pour plus de clarté, car 'Ville' est créé juste avant)
mutate(
etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G")),
Ville = factor(Ville, levels = c("Lyon", "Lille"))
)
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(scales)
# Import des données
url_lyon = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
url_lille = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_59.csv"
data_lyon = read.csv2(url_lyon, header = TRUE)
data_lille = read.csv2(url_lille, header = TRUE)
# Combinaison
data_combined <- rbind(
data_lyon,
data_lille
) %>%
mutate(
# 1. Créer la variable "Ville" propre à partir du code BAN
Ville = case_when(
code_departement_ban == 69 ~ "Lyon",
code_departement_ban == 59 ~ "Lille"
),
# 2. Créer les métriques au m²
conso_m2_total = cout_total_5_usages / surface_habitable_logement,
conso_m2_chauffage = cout_chauffage / surface_habitable_logement
) %>%
# 3. Assurer l'ordre des facteurs pour les graphiques
mutate(
etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G")),
Ville = factor(Ville, levels = c("Lyon", "Lille"))
)
View(data_combined)
ggplot(data_combined, aes(x = etiquette_dpe, fill = Ville)) +
# geom_bar(position = "fill") calcule la proportion (le 100%)
geom_bar(position = "fill") +
facet_grid(Ville ~ flag) +
scale_y_continuous(labels = scales::percent_format()) +
labs(
title = "Répartition des étiquettes DPE par Ville et Type de Bâti",
x = "Classe DPE",
y = "Proportion",
fill = "Ville"
) +
scale_fill_manual(values = c("Lyon" = "#0047AB", "Lille" = "#FFA500")) +
theme_minimal()
ggplot(data_combined,
aes(x = etiquette_dpe, y = Proportion, fill = Ville)) +
# utilisation de position_dodge pour mettre les diagrammes en barres côte à côte
geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
#Ajout des proportions (en %) au-dessus des barres
geom_text(
aes(label = scales::percent(Proportion, accuracy = 0.1)),
position = position_dodge(width = 0.9),
vjust = -0.5, #position  verticale du texte
size = 3
) +
labs(
title = "Répartition des étiquettes DPE (Lyon vs. Lille)",
x = "Classe DPE",
y = "Proportion des logements (%)",
fill = "Ville"
) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("Lyon" = "#0047AB", "Lille" = "#FFA500")) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(scales)
# Import des données
url_lyon = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
url_lille = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_59.csv"
data_lyon = read.csv2(url_lyon, header = TRUE)
data_lille = read.csv2(url_lille, header = TRUE)
# Combinaison
data_combined <- rbind(
data_lyon,
data_lille
) %>%
mutate(
# 1. Créer la variable "Ville" propre à partir du code BAN
Ville = case_when(
code_departement_ban == 69 ~ "Lyon",
code_departement_ban == 59 ~ "Lille"
),
# 2. Créer les métriques au m²
conso_m2_total = cout_total_5_usages / surface_habitable_logement,
conso_m2_chauffage = cout_chauffage / surface_habitable_logement
) %>%
# 3. Assurer l'ordre des facteurs pour les graphiques
mutate(
etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G")),
Ville = factor(Ville, levels = c("Lyon", "Lille"))
)
ggplot(data_combined,
aes(x = etiquette_dpe, y = Proportion, fill = Ville)) +
# utilisation de position_dodge pour mettre les diagrammes en barres côte à côte
geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
#Ajout des proportions (en %) au-dessus des barres
geom_text(
aes(label = scales::percent(Proportion, accuracy = 0.1)),
position = position_dodge(width = 0.9),
vjust = -0.5, #position  verticale du texte
size = 3
) +
labs(
title = "Répartition des étiquettes DPE (Lyon vs. Lille)",
x = "Classe DPE",
y = "Proportion des logements (%)",
fill = "Ville"
) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("Lyon" = "#0047AB", "Lille" = "#FFA500")) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(scales)
# Import des données
url_lyon = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
url_lille = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_59.csv"
data_lyon = read.csv2(url_lyon, header = TRUE)
data_lille = read.csv2(url_lille, header = TRUE)
# Combinaison
data_combined <- rbind(
data_lyon,
data_lille
) %>%
mutate(
# 1. Créer la variable "Ville" propre à partir du code BAN
Ville = case_when(
code_departement_ban == 69 ~ "Lyon",
code_departement_ban == 59 ~ "Lille"
),
# 2. Créer les métriques au m²
conso_m2_total = cout_total_5_usages / surface_habitable_logement,
conso_m2_chauffage = cout_chauffage / surface_habitable_logement
) %>%
# 3. Assurer l'ordre des facteurs pour les graphiques
mutate(
etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G")),
Ville = factor(Ville, levels = c("Lyon", "Lille"))
)
data_dpe_counts <- data_combined %>%
mutate(etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G"))) %>%
filter(!is.na(etiquette_dpe)) %>% # Retirer les DPE manquants si existants
group_by(Ville) %>%
mutate(Total_Ville = n()) %>% # Calculer le total par ville (pour le %)
group_by(Ville, etiquette_dpe, Total_Ville) %>%
summarise(
Nombre = n(),
Proportion = Nombre / first(Total_Ville), # Calculer la proportion
.groups = 'drop'
)
#création du graphique
ggplot(data_dpe_counts,
aes(x = etiquette_dpe, y = Proportion, fill = Ville)) +
# utilisation de position_dodge pour mettre les diagrammes en barres côte à côte
geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
#Ajout des proportions (en %) au-dessus des barres
geom_text(
aes(label = scales::percent(Proportion, accuracy = 0.1)),
position = position_dodge(width = 0.9),
vjust = -0.5, #position  verticale du texte
size = 3
) +
labs(
title = "Répartition des étiquettes DPE (Lyon vs. Lille)",
x = "Classe DPE",
y = "Proportion des logements (%)",
fill = "Ville"
) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("Lyon" = "#0047AB", "Lille" = "#FFA500")) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
library(dplyr)
library(tidyr)
library(ggplot2)
library(knitr)
library(scales)
# Import des données
url_lyon = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_69.csv"
url_lille = "https://raw.githubusercontent.com/ndhho/iut_sd2_rshiny_enedis/main/data/clean_csv/logements_59.csv"
data_lyon = read.csv2(url_lyon, header = TRUE)
data_lille = read.csv2(url_lille, header = TRUE)
# Combinaison
data_lyon <- data_lyon %>% mutate(Ville = "Lyon")
data_lille <- data_lille %>% mutate(Ville = "Lille")
data_combined_raw <- rbind(data_lyon, data_lille)
data_dpe_counts <- data_combined_raw %>%
mutate(etiquette_dpe = factor(etiquette_dpe, levels = c("A", "B", "C", "D", "E", "F", "G"))) %>%
filter(!is.na(etiquette_dpe)) %>% # Retirer les DPE manquants si existants
group_by(Ville) %>%
mutate(Total_Ville = n()) %>% # Calculer le total par ville (pour le %)
group_by(Ville, etiquette_dpe, Total_Ville) %>%
summarise(
Nombre = n(),
Proportion = Nombre / first(Total_Ville), # Calculer la proportion
.groups = 'drop'
)
#création du graphique
ggplot(data_dpe_counts,
aes(x = etiquette_dpe, y = Proportion, fill = Ville)) +
# utilisation de position_dodge pour mettre les diagrammes en barres côte à côte
geom_bar(stat = "identity", position = position_dodge(width = 0.9)) +
#Ajout des proportions (en %) au-dessus des barres
geom_text(
aes(label = scales::percent(Proportion, accuracy = 0.1)),
position = position_dodge(width = 0.9),
vjust = -0.5, #position  verticale du texte
size = 3
) +
labs(
title = "Répartition des étiquettes DPE (Lyon vs. Lille)",
x = "Classe DPE",
y = "Proportion des logements (%)",
fill = "Ville"
) +
scale_y_continuous(labels = scales::percent) +
scale_fill_manual(values = c("Lyon" = "#0047AB", "Lille" = "#FFA500")) +
theme_minimal() +
theme(plot.title = element_text(hjust = 0.5))
View(data_combined)
View(data_combined_raw)
