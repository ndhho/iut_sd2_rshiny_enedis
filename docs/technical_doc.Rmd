---
title: "Documentation technique de l’application en markdown"
author: "HO Huy, TRAN Cloelia"
date: "`r Sys.Date()`"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
```

# Documentation Technique : Analyse DPE Lyon vs Lille

Ce document détaille l'architecture technique et la procédure d'installation de l'application Shiny d'analyse des DPE.

## 1\. Schéma de l'architecture

L'application repose sur une architecture "gated" (à accès contrôlé) où la logique principale du serveur n'est chargée qu'après une authentification réussie.

### 1.1. Flux des données

Les données brutes sont hébergées sur GitHub et chargées au démarrage de l'application. Les coordonnées géographiques (Lambert-93) sont converties en WGS84 (Lat/Lon) une seule fois avant d'être utilisées par l'application.

```mermaid
graph TD
    A(Utilisateur [Navigateur Web]) <--> B(Application Shiny [app.R])
    B -- 1. Chargement au démarrage --> C(Source 1: logements_59.csv [GitHub])
    B -- 2. Chargement au démarrage --> D(Source 2: logements_69.csv [GitHub])
    B -- 3. Conversion SF --> E(Données Géospatiales [lat/lon])
    B -- 4. Rendu HTML/JS --> A
```

### 1.2. Architecture de l'application (`app.R`)

L'application utilise un `uiOutput` principal qui bascule entre deux interfaces utilisateur distinctes, en fonction d'une variable réactive `user_auth()`.

```mermaid
graph TD
    subgraph "Serveur (server.R)"
        S1(Logique de Connexion) -- Valide? --> S2(Authentification [user_auth(TRUE)])
        S2 -- Déclenche --> S3(Chargement de la Logique Métier)
        S3 --> S4(Filtres réactifs)
        S3 --> S5(Rendu des Graphiques)
        S3 --> S6(Rendu de la Carte)
    end
    
    subgraph "Interface (ui.R)"
        U0(uiOutput) -- Affiche --> U1(UI - Connexion)
        U0 -- Affiche --> U2(UI - Dashboard Principal)
    end
    
    S2 -- Bascule --> U0
```

## 2\. Packages Nécessaires

L'application repose sur les 9 packages R suivants.

  * **shiny** : Framework principal de l'application.
  * **shinydashboard** : Structure le tableau de bord (header, sidebar, body).
  * **dplyr** : Utilise pour toutes les manipulations de données (filtres, `group_by`, `summarise`).
  * **ggplot2** : Moteur de génération pour tous les graphiques (histogrammes, barres, nuages de points...).
  * **scales** : Permet de formater les axes et les étiquettes (ex: `percent()`).
  * **leaflet** : Génère la carte interactive (points, légendes, popups).
  * **DT** : Affiche les tables de données interactives (onglet "Contexte").
  * **sf** : Requis pour la conversion des coordonnées géographiques (Lambert-93 vers WGS84).
  * **shinythemes** : Permet le changement de thème par l'utilisateur.

## 3\. Guide d'installation

Voici les étapes pour installer et lancer l'application sur un poste local.

### 3.1. Prérequis

  * **R** (version 4.0 ou supérieure).
  * **RStudio** (recommandé).

### 3.2. Installation des packages

1.  Ouvrez RStudio et copiez-collez la commande suivante dans la console pour installer tous les packages requis :

    ```r
    install.packages(c("shiny", "shinydashboard", "dplyr", "ggplot2", "scales", "leaflet", "DT", "sf", "shinythemes"))
    ```

2.  **Note importante pour `sf`** : Ce package peut avoir des dépendances système (comme `GDAL` ou `GEOS`). Si l'installation échoue, suivez les instructions spécifiques à votre système d'exploitation (Windows, macOS, ou Linux) disponibles sur [la page du package `sf`](https://www.google.com/search?q=%5Bhttps://r-spatial.github.io/sf/%23installing%5D\(https://r-spatial.github.io/sf/%23installing\)).

### 3.3. Lancement de l'application

1.  Créez un nouveau dossier pour votre projet (ex: `MonProjetShiny`).

2.  À l'intérieur de ce dossier, créez un fichier nommé `app.R` et copiez-y l'intégralité du script de l'application.

3.  Dans ce même dossier, créez un sous-dossier nommé **`www`**.

4.  À l'intérieur du dossier `www`, créez un fichier nommé **`style.css`**.

5.  Copiez le code CSS suivant dans `www/style.css` (Ceci est la charte graphique Enedis) :

    ```css
    /* --- Charte Visuelle "ENEDIS" --- */
    .skin-blue .main-header .navbar { background-color: #005DB9; }
    .skin-blue .main-header .logo { background-color: #004B9A; color: #FFFFFF; font-weight: bold; }
    .skin-blue .main-header .logo:hover { background-color: #003A75; }
    .skin-blue .main-sidebar { background-color: #2F2F2F; }
    .skin-blue .main-sidebar .sidebar .sidebar-menu .active a { background-color: #222222; border-left-color: #92C814; }
    .skin-blue .main-sidebar .sidebar .sidebar-menu a:hover { background-color: #3e3e3e; border-left-color: #005DB9; }
    .box.box-solid.box-primary > .box-header { background: #005DB9; border-color: #005DB9; }
    .box.box-solid.box-info > .box-header { background: #9E9E9E; border-color: #9E9E9E; }
    .box.box-solid.box-warning > .box-header { background: #92C814; border-color: #92C814; color: #2F2F2F; }
    .small-box.bg-blue { background-color: #005DB9 !important; }
    .small-box.bg-green { background-color: #92C814 !important; color: #2F2F2F !important; }
    ```

6.  Ouvrez le fichier `app.R` dans RStudio.

7.  Cliquez sur le bouton **"Run App"** en haut à droite de l'éditeur de script.

8.  L'application se lancera et vous présentera l'écran de connexion.

### 3.4. Identifiants de connexion

  * **Utilisateur :** `admin`
  * **Mot de passe :** `admin`
